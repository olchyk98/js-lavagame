let settings={devTesting:!1,chTesting:!0,gmTesting:!1,musicOn:!0,soundsOn:!0,playerCanHook:!0,gameplayBackground:null,blockSize:34,canvas:{height:445,width:850,FPS:30,target:null},inGame:!0,inMenu:!0,menuMouseMove:{x:0,y:0},menuMouseClick:{x:null,y:null},playerHBHeight:17.5,rave:{ravesTime:35,ravesTimeRange:15,minDelta:900,maxDelta:3e3,minEnd:400,maxEnd:1500},rage:{minDelta:600,maxDelta:4e3,minEnd:400,maxEnd:1500},gameAssets:{BACKGROUND_MENU:{id:1,type:"THEME",model:null},BACKGROUND_1:{id:2,type:"THEME",model:null},BACKGROUND_2:{id:3,type:"THEME",model:null},BACKGROUND_3:{id:4,type:"THEME",model:null},BACKGROUND_4:{id:5,type:"THEME",model:null},BACKGROUND_5:{id:6,type:"THEME",model:null},BLOCK:{id:15,markupID:1,type:"BLOCK",model:null},LAVA:{id:16,markupID:2,type:"BLOCK",model:[]},GLASS:{markupID:3,type:"TEXTURE",model:null},ARMOR_1:{id:30,type:"ITEM",health:15,model:null},ARMOR_2:{id:31,type:"ITEM",health:25,model:null},ARMOR_3:{id:32,type:"ITEM",health:45,model:null},ARMOR_4:{id:33,type:"ITEM",health:115,model:null},HELMET:{id:34,type:"ITEM",health:30,model:null},BOOTS:{id:35,type:"ITEM",speed:5,limit:600,model:null},SHIELD_ITEM:{id:36,type:"ITEM",model:null},HEALTH_BOTTLE:{id:37,type:"ITEM",health:120,model:null},MAGE_SPAWNER:{name:"Mage",id:38,type:"ITEM",model:null},METEOR_SUMMONER:{name:"Meteor",id:39,type:"ITEM",model:null},GOLD_KEY:{id:40,type:"ITEM",score:1e3,model:null},SILVER_KEY:{id:41,type:"ITEM",score:500,model:null},BRONZE_KEY:{id:42,type:"ITEM",score:250,model:null},METEOR:{id:60,type:"OBJECT",model:null,speed:24},SHIELD:{id:61,type:"OBJECT",model:null,time:175},GORILLA_BOMB:{id:62,type:"OBJECT",model:null},HERO_BOMB:{id:63,type:"OBJECT",model:null,range:100,damage:150},HERO_BULLET:{id:80,type:"BULLET",model:null},LIZARD_BULLET:{id:81,type:"BULLET",model:null},MONSTER_2_BULLET:{id:82,type:"BULLET",model:null},MAGE_BULLET:{id:83,type:"BULLET",model:null},SLIME:{id:100,class:"Slime",type:"MONSTER",subType:"GROUND",model:null,health:75,regeneration:0,damage:15,attackDelta:30,minSpeed:1.5,maxSpeed:2,maxJumps:1,jumpHeight:12},LIZARD:{id:101,class:"Lizard",type:"MONSTER",subType:"GROUND",model:null,health:20,regeneration:5,minSpeed:4.5,maxSpeed:5,damage:10,bulletRange:400,bulletSpeed:20,attackDelta:40,maxJumps:2,jumpHeight:12},GORILLA:{id:102,class:"Gorilla",type:"MONSTER",subType:"GROUND",model:null,health:200,regeneration:75,minSpeed:1,maxSpeed:1.5,damage:10,attackDelta:20,bombDelta:200,maxJumps:1,jumpHeight:7.5,bombRange:400,bombTime:100,bombDamage:20},BIRD:{id:103,class:"Bird",type:"MONSTER",subType:"AIR",model:null,health:5,minSpeed:5,maxSpeed:15,bombDelta:150,bombTime:100,bombDamage:80,throwRange:30},SMOKE:{id:120,type:"VISUAL",model:[]},ELECTRO:{id:121,type:"VISUAL",model:[]},MAGE:{id:140,type:"HERO",models:{app:[],attack:[],go:[],jump:[],stay:[],summon:[],dead:[]},health:100,regeneration:15,shootDamage:5,hitDamage:20,teleportDamage:15,minSpeed:2,maxSpeed:6,bulletRange:1/0,bulletSpeed:20,shootDelta:60,hitDelta:180,teleportDelta:150,hitRange:300,alive:1e3}},sounds:{ARMOR_GET:{id:160,type:"SOUND",audio:null},DIE:{id:161,type:"SOUND",audio:null},HIT:{id:162,type:"SOUND",audio:null},ITEM_GET:{id:163,type:"SOUND",audio:null},JUMP:{id:164,type:"SOUND",audio:null},MAGE_HIT:{id:165,type:"SOUND",audio:null},MAGE_SUMMON:{id:166,type:"SOUND",audio:null},METEOR:{id:167,type:"SOUND",audio:null},RAGE:{id:168,type:"SOUND",audio:null},RAVE:{id:169,type:"SOUND",audio:null},SELECT:{id:170,type:"SOUND",audio:null},SHOOT:{id:171,type:"SOUND",audio:null},START_LEVEL:{id:172,type:"SOUND",audio:null},TELEPORT:{id:173,type:"SOUND",audio:null},TEXT:{id:174,type:"SOUND",audio:null},SELECT:{id:175,type:"SOUND",audio:null},SCOREUP:{id:176,type:"SOUND",audio:null},EXPLOSION:{id:177,type:"SOUND",audio:null}},music:{MEGALOVANIA:{id:200,type:"MUSIC",audio:null},BONETROUSLE:{id:201,type:"MUSIC",audio:null},ASGORE:{id:202,type:"MUSIC",audio:null}},icons:{SOUNDS_ICON:{id:240,type:"ICON",image:null},MUSIC_ICON:{id:240,type:"ICON",image:null},HOOK_ICON:{id:241,type:"ICON",image:null}},itemKeys:[70,71,66,78]},player={id:0,models:{idle:null,run:null,jump:null,fly:null},OBJECT:null,heatlh:125,regeneration:25,damage:10,minSpeed:4.5,maxSpeed:5,bulletRange:.75*settings.canvas.width,bombDelta:25*settings.canvas.FPS},monsters=[],monstersID=0,bullets=[],bulletsID=0,meteors=[],meteorsID=0,mbombs=[],mbombsID=0,hbombs=[],hbombsID=0,mages=[],magesID=0,items=[],itemsID=0,itemsRefresh={started:!1,wait:0,delta:0},touchableElements=[],defaultSession={currentSong:null,startTime:5*settings.canvas.FPS,monsterMinTime:settings.canvas.FPS,monsterMaxTime:3*settings.canvas.FPS,monsterDelta:0,isRave:!1,raveDelta:Math.floor(Math.random()*(settings.rave.maxDelta-settings.rave.minDelta)+settings.rave.minDelta),raveEnd:Math.floor(Math.random()*(settings.rave.maxEnd-settings.rave.minEnd)+settings.rave.minEnd),ravesTi:1/0,isRage:!1,rageDelta:Math.floor(Math.random()*(settings.rage.maxDelta-settings.rage.minDelta)+settings.rage.minDelta),rageEnd:Math.floor(Math.random()*(settings.rage.maxEnd-settings.rage.minEnd)+settings.rage.minEnd),ragesTi:1/0},session=null,score={iterations:0,score:0},scoreDef={MONSTER_KILL:200,LAVA_DEATH:25};const maps=[{map:[[0,0,0,0,0,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,2,1,2,1,1,2,1,1,1,1,1,1,1,1,1,1]],backgroundID:settings.gameAssets.BACKGROUND_1.id},{map:[[0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,2,1,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,1,1,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],backgroundID:settings.gameAssets.BACKGROUND_2.id},{map:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0],[0,0,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,3,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,3,3,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0],[2,1,1,1,1,1,1,1,2,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1]],backgroundID:settings.gameAssets.BACKGROUND_4.id},{map:[[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,0,0,0,1,2,1,0,0,0,0,0,0,0,0,3,0,0],[0,0,0,3,0,0,0,0,0,0,1,1,2,1,1,0,0,0,0,0,0,3,0,0,0],[0,0,0,0,0,0,0,0,0,1,1,1,2,1,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,3,1,1,2,1,1,3,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,3,1,1,2,1,1,3,1,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,3,1,1,2,1,1,3,1,1,1,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,3,1,1,2,1,1,3,1,1,1,1,1,1,1,1,1]],backgroundID:settings.gameAssets.BACKGROUND_3.id},{map:[[0,0,0,0,0,0,0,0,1,1,1,3,3,3,1,1,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,2,2,2,2,2,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,2,2,2,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,3,2,2,2,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,3,2,2,2,3,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,0,0,1,2,2,2,1,0,0,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,2,2,2,1,1,1,1,1,1,1,1,1,1,1]],backgroundID:settings.gameAssets.BACKGROUND_5.id}];let map=[];function playSound(s){settings.soundsOn&&s.play()}function playSong(){let s=Object.values(settings.music).map(({audio:s})=>s),e=s[floor(random(s.length))];e.play(),e.onended(playSong),session.currentSong=e}function start(s=!1){settings.musicOn&&!settings.devTesting||(s=!1),settings.canvas.target.style="\n\t\tcursor:default;\n\t\tfilter:inherit;\n\t",score.iterations++,session=Object.assign({},defaultSession),settings.inGame=!0,settings.inMenu=!1,monsters.length=monstersID=bullets.length=bulletsID=meteors.length=meteorsID=mbombs.length=mbombsID=hbombs.length=hbombsID=mages.length=magesID=items.length=itemsID=0,itemsRefresh={started:!1,wait:0,delta:0},player.OBJECT=new Player,s&&playSong();{let s=maps[floor(random(maps.length))];map=s.map,settings.gameplayBackground=Object.values(settings.gameAssets).find(e=>e.id===s.backgroundID).model}}function updateLocalStorage(){localStorage.setItem("GLOBAL_SETTINGS",JSON.stringify({musicOn:settings.musicOn,soundsOn:settings.soundsOn,playerCanHook:settings.playerCanHook}))}settings.chTesting?(window.____VALIDATEGAME=function(){return!(!settings.inGame||settings.inMenu||!player.OBJECT)||(console.error("The game is not initialized"),!1)},window.___SPAWNITEM=function(s){window.____VALIDATEGAME()&&items.push(new Item(++itemsID,settings.gameAssets[s].model,!0,settings.gameAssets[s].id))},window.___SPAWNITEMS=function(){if(window.____VALIDATEGAME()){let s=settings.gameAssets;Object.keys(s).filter(e=>"ITEM"===s[e].type).forEach(s=>{items.push(new Item(++itemsID,settings.gameAssets[s].model,!0,settings.gameAssets[s].id))})}},window.___SPAWNMONSTER=function(s){window.____VALIDATEGAME()&&monsters.push(new[s](++monstersID,!0))},window.___MANYHEALTH=function(){window.____VALIDATEGAME()&&(player.OBJECT.maxHealth=1/0,player.OBJECT.health=1/0)},window.___MUTESONG=function(){window.____VALIDATEGAME()&&(session.currentSong&&session.currentSong.stop(),session.musicOn=!1)},window.___MUTESOUND=function(){window.____VALIDATEGAME()&&(session.soundsOn=!1)},window.___STARTRAVE=function(){window.____VALIDATEGAME()&&(session.isRave=!0,session.raveDelta=0,session.raveEnd=1/0,session.ravesTi=1/0)},window.___STOPRAVE=function(){window.____VALIDATEGAME()&&(session.isRave=defaultSession.isRave,session.raveDelta=defaultSession.raveDelta,session.raveEnd=defaultSession.raveEnd,session.ravesTi=defaultSession.ravesTi)},window.___STARTRAGE=function(){window.____VALIDATEGAME()&&(session.isRage=!0,session.rageDelta=0,session.rageEnd=1/0,session.ragesTi=1/0)},window.___STOPRAGE=function(){window.____VALIDATEGAME()&&(session.isRage=defaultSession.isRage,session.rageDelta=defaultSession.rageDelta,session.rageEnd=defaultSession.rageEnd,session.ragesTi=defaultSession.ragesTi)},window.___NEXTITERATION=function(){window.____VALIDATEGAME()&&start(!1)},window.___PUSHSCORE=function(s){window.____VALIDATEGAME()&&player.OBJECT.pushScore(s)}):window.___SPAWNITEM=window.___SPAWNITEMS=window.___SPAWNMONSTER=window.___MANYHEALTH=window.___MUTESONG=window.___MUTESOUND=window.___STARTRAVE=window.___STOPRAVE=window.___STARTRAGE=window.___STOPRAGE=window.___NEXTITERATION=window.___PUSHSCORE=function(){return console.warn("Cheats are not available when chTesting constant equals true.")};class Element{constructor(s=!1,e=-1,t=-1,i,a=0){this.isBlock=s,s&&(this.size=settings.blockSize,this.leftIndex=e,this.bottomIndex=t,this.pos={x:e*this.size,y:settings.canvas.height-(map.length-t)*this.size}),this.type=i,this.id=a}predictObstacle(s,e,t){let{x:i,y:a}=s,{x:n,y:o}=this.pos;if(i+e>=n&&i<=n+this.size&&a+t>=o&&a<=o+this.size)return this}}class Block extends Element{constructor(s,e,t,i){super(!0,s,e,t,0),this.texture=i||settings.gameAssets.BLOCK.model}render(){return image(this.texture,this.pos.x,this.pos.y,this.size,this.size),this}}class Lava extends Element{constructor(s,e,t){super(!0,s,e,t,0),this.currentFrame=0,this.currentSprite=0}render(){return image(settings.gameAssets.LAVA.model[this.currentSprite],this.pos.x,this.pos.y,this.size,this.size),this}update(){if(settings.inGame)return++this.currentFrame%5==0&&++this.currentSprite>settings.gameAssets.LAVA.model.length-1&&(this.currentSprite=0),this}}class Creature{constructor(s=0,e,t,i,a,n,o,l,h,g,d,r,m,p=3,u=0,c=0,E){if(this.isAlive=!0,this.race=e,this.id=s,this.typenum=E,this.models=n,this.model=this.models&&this.models.idle||this.models,this.damage=g,this.bulletRange=u,this.bulletSpeed=c,this.asl=d,"object"!=typeof d)this.aslDelta=0;else{let s=Object.assign({},d);Object.keys(s).forEach(e=>{s[e]=0}),this.aslDelta=s}if(this.pos=t||{x:0,y:0},this.strictJump=!0,this.maxJumps=p,this.jumps=0,this.width=o,this.height=l,!this.width||!this.height)throw alert("ERROR! Check the console!"),new Error("We couldn't load creature's dimensions. Please, provide these values.");this.gravity=30/settings.canvas.FPS,this.velocity=0,this.speed=r,this.jumpHeight=m,this.movement=0,this.direction=1,this.maxHealth=i,this.health=a||i,h&&(this.regenDelta=0,this.regenPower=h),this.set={helmet:null,armor:null,shield:null}}update(){if(this.pos.y>settings.canvas.height)return this.declareDamage(10),this;if(!this.isAlive)return this;"object"!=typeof this.aslDelta?--this.aslDelta<0&&(this.aslDelta=0):Object.keys(this.aslDelta).forEach(s=>{--this.aslDelta[s]<0&&(this.aslDelta[s]=0)}),"hero"===this.race&&this.id===player.id&&this.bombDelta&&(this.bombDelta--,this.bombDelta<0&&(this.bombDelta=0)),"hero"===this.race&&this.set.shield&&--this.set.shield.time<=0&&(this.set.shield=null);let s=!0,e=!0,t=0,i=-1,a=this.speed+(this.set.boots&&this.set.boots.speed||0);if(touchableElements.forEach(n=>{let o=n.predictObstacle({x:this.pos.x,y:this.pos.y+(this.velocity+this.gravity)},this.width,this.height),l=n.predictObstacle({x:this.pos.x+this.movement*a,y:this.pos.y},this.width,this.height);if(l){"hero"===this.race&&this.id===player.id&&(this.touches.x=!0);var h=l;l=l.type}else"hero"===this.race&&this.id===player.id&&(this.touches.x=!1);if(o){"hero"===this.race&&this.id===player.id&&(this.touches.y=!1);var g=o;o=o.type}else"hero"===this.race&&this.id===player.id&&(this.touches.y=!1);if([l,o].includes(settings.gameAssets.BLOCK.id)||[l,o].includes(settings.gameAssets.LAVA.id)){if([l,o].includes(settings.gameAssets.LAVA.id)?(t||(t+=10),i=l,"hero"===this.race&&(this.jumps=0)):(this.canHook||!l&&g&&g.pos.y>this.pos.y+(this.height||this.size))&&(this.jumps=this.maxJumps),o&&s&&(s=!1,this.velocity=this.gravity),l&&e&&(e=!1),"monster"===this.race&&this.detectObstacle&&settings.inGame&&this.isAlive){let s=h,e=g;(s||e)&&this.detectObstacle(s,e)}}else if(l||o){if(l!==o)return;switch(l){case settings.gameAssets.HEALTH_BOTTLE.id:h.destroy(),playSound(settings.sounds.ITEM_GET.audio),this.health+=settings.gameAssets.HEALTH_BOTTLE.health,this.health>this.maxHealth&&(this.health=this.maxHealth);break;case settings.gameAssets.ARMOR_1.id:h.destroy(),"hero"===this.race&&(playSound(settings.sounds.ARMOR_GET.audio),this.set.armor={name:"ARMOR_1",health:settings.gameAssets.ARMOR_1.health});break;case settings.gameAssets.ARMOR_2.id:"hero"===this.race&&(h.destroy(),playSound(settings.sounds.ARMOR_GET.audio),this.set.armor={name:"ARMOR_2",health:settings.gameAssets.ARMOR_2.health});break;case settings.gameAssets.ARMOR_3.id:"hero"===this.race&&(h.destroy(),playSound(settings.sounds.ARMOR_GET.audio),this.set.armor={name:"ARMOR_3",health:settings.gameAssets.ARMOR_3.health});break;case settings.gameAssets.ARMOR_4.id:"hero"===this.race&&(h.destroy(),playSound(settings.sounds.ARMOR_GET.audio),this.set.armor={name:"ARMOR_4",health:settings.gameAssets.ARMOR_4.health});break;case settings.gameAssets.HELMET.id:"hero"===this.race&&(h.destroy(),playSound(settings.sounds.ARMOR_GET.audio),this.set.helmet={name:"HELMET",health:settings.gameAssets.HELMET.health});break;case settings.gameAssets.BOOTS.id:"hero"===this.race&&(h.destroy(),playSound(settings.sounds.ARMOR_GET.audio),this.set.boots={name:"BOOTS",speed:settings.gameAssets.BOOTS.speed,limit:settings.gameAssets.BOOTS.limit});break;case settings.gameAssets.SHIELD_ITEM.id:"hero"===this.race&&this.id===player.id&&(h.destroy(),playSound(settings.sounds.ARMOR_GET.audio),this.set.shield={name:"SHIELD_ITEM",time:settings.gameAssets.SHIELD.time});break;case settings.gameAssets.MAGE_SPAWNER.id:"hero"===this.race&&this.id===player.id&&(h.destroy(),playSound(settings.sounds.ITEM_GET.audio),this.takeItem("MAGE_SPAWNER"));break;case settings.gameAssets.METEOR_SUMMONER.id:"hero"===this.race&&this.id===player.id&&(h.destroy(),playSound(settings.sounds.ITEM_GET.audio),this.takeItem("METEOR_SUMMONER"));break;case settings.gameAssets.GOLD_KEY.id:case settings.gameAssets.SILVER_KEY.id:case settings.gameAssets.BRONZE_KEY.id:h.destroy(),"hero"===this.race&&this.typenum===player.id&&(h.type===settings.gameAssets.GOLD_KEY.id?this.pushScore(settings.gameAssets.GOLD_KEY.score):h.type===settings.gameAssets.SILVER_KEY.id?this.pushScore(settings.gameAssets.SILVER_KEY.score):h.type===settings.gameAssets.BRONZE_KEY.id&&this.pushScore(settings.gameAssets.BRONZE_KEY.score));break;case settings.gameAssets.HERO_BULLET.id:case settings.gameAssets.MAGE_BULLET.id:"hero"!==this.race&&(h.destroy(),t+=h.damage,i=settings.gameAssets.MAGE_BULLET.id);break;case settings.gameAssets.LIZARD_BULLET.id:"monster"!==this.race&&(h.destroy(),t+=h.damage,i=settings.gameAssets.LIZARD_BULLET.id);break;case settings.gameAssets.METEOR.id:"hero"!==this.race&&(t+=h.damage,i=settings.gameAssets.METEOR.id)}}}),this.declareDamage(t,i),this.velocity+=this.gravity,s&&(this.pos.y+=this.velocity),e){let s=this.set.boots;s&&(s.limit-=abs(this.movement*a),s.limit<=0&&(this.set.boots=null)),this.pos.x+=this.movement*a,this.movement&&(this.direction=Math.sign(this.movement)),this.pos.x+this.width>settings.canvas.width&&"monster"!==this.race?this.pos.x=settings.canvas.width-this.width:this.pos.x<0&&(this.pos.x=0)}return-1!==Math.sign(this.velocity)?s?this.model=this.models.fly||this.model:this.movement&&(this.model=this.models.idle||this.model):this.model=this.models.jump||this.model,this}declareDamage(s,e){if(session.startTime)return;let{helmet:t,armor:i,shield:a}=this.set,n=s=>this.health<=0?this.declareDeath(s):null;if(!a)if(t){let i=t.health-s;i>0?t.health=i:0===i?delete this.set.helmet:(this.health-=s-=t.health,n(e),delete this.set.helmet)}else if(i){let t=i.health-s;t>0?i.health=t:0===t?delete this.set.armor:(this.health-=s-=i.health,n(e),delete this.set.armor)}else this.health-=s,n(e)}regenerate(){this.regenPower&&this.isAlive&&settings.inGame&&++this.regenDelta%125==0&&(this.regenDelta=1,this.health+=this.regenPower,this.health>this.maxHealth&&(this.health=this.maxHealth))}controlPos(s){this.movement=s}jump(s=1){let e=!1;for(let t=0;t<s;t++){if(!this.jumps)return;e||(playSound(settings.sounds.JUMP.audio),e=!0),this.velocity=-this.jumpHeight,this.strictJump&&this.jumps--}}declareDeath(s){if(this.isAlive=!1,this.health=0,this.set={},"hero"===this.race)this.typenum===player.id?(settings.inGame=!1,settings.canvas.target.style.filter="grayscale(100%)",playSound(settings.sounds.DIE.audio)):this.typenum===settings.gameAssets.MAGE.id&&this.die();else if("monster"===this.race){let e=monsters;e.splice(e.findIndex(s=>s.id===this.id),1),[settings.gameAssets.HERO_BOMB.id,settings.gameAssets.HERO_BULLET.id,settings.gameAssets.MAGE_BULLET.id,settings.gameAssets.METEOR.id].includes(s)?player.OBJECT.pushScore(scoreDef.MONSTER_KILL):s===settings.gameAssets.LAVA.id&&player.OBJECT.pushScore(-scoreDef.LAVA_DEATH)}}}class Meteor extends Element{constructor(s,e=null,t=null,i){let a=settings.gameAssets.METEOR;super(!1,-1,-1,a.id,s),this.damage=400,this.model=a.model,this.size=150,this.speed=a.speed;{let s=i,t=settings.canvas,a=s.x>t.width/2;this.pos=e||{y:s.y-t.height,x:a?s.x-t.height:s.x+t.height},this.direction={x:a?1:-1,y:1}}}render(){return push(),tint(255,100),image(this.model,this.pos.x,this.pos.y,this.size,this.size),pop(),this}update(){if(this.pos.x+=this.direction.x*this.speed,this.pos.y+=this.direction.y*this.speed,this.pos.y>settings.canvas.height){let s=meteors;s.splice(s.findIndex(s=>s.id===this.id),1)}}}class Bullet extends Element{constructor(s,e,t=1,i,a,n,o,l){super(!1,-1,-1,e,s),this.size=25,this.damage=t,this.model=i,this.rangeX=l,this.ranged=0,this.pos=a||{x:0,y:0},this.direction=n||{x:1,y:0},this.speed=o}render(){return image(this.model,this.pos.x,this.pos.y,this.size,this.size),this}update(){if(!settings.inGame)return;let s=touchableElements.filter(s=>s.type!==this.type),e=!0;if(s.forEach(s=>{let t=s.predictObstacle({x:this.pos.x+this.direction.x*this.speed,y:this.pos.y+this.direction.y*this.speed},this.size,this.size);t&&t.constructor.name!==this.constructor.name&&t.type!==settings.gameAssets.GORILLA_BOMB.id&&(e=!1,t.destroy&&t.destroy())}),e){let s=this.direction.x*this.speed;this.pos.x+=s,this.ranged+=s,this.ranged>this.rangeX&&this.destroy(),this.pos.y+=this.direction.y*this.speed}return(!e||this.pos.x>settings.canvas.width||this.pos.x+this.size<0)&&this.destroy(),this}destroy(){bullets.splice(bullets.findIndex(s=>s.id===this.id),1)}}class Hero extends Creature{constructor(...s){super(...s),this.canHook=settings.playerCanHook}takeItem(s){let e=this.items,t=settings.itemKeys,i=!1;e.length>t.length-1&&(e.splice(0,1),i=!0),e.forEach((s,e,i)=>{i[e].runKey=t[e]}),e.push({name:s,runKey:t[e.length]})}useItem(s){if(!this.isAlive)return;let e=this.items,t=e.findIndex(({runKey:e})=>e===s);if(t<0)return;let i=settings.gameAssets[e[t].name].id;switch(e.splice(t,1),i){case settings.gameAssets.MAGE_SPAWNER.id:mages.push(new Mage(++magesID,this)),playSound(settings.sounds.MAGE_SUMMON.audio);break;case settings.gameAssets.METEOR_SUMMONER.id:{let s=Object.assign({},this.pos);s.y-=2*this.height,s.height=2,meteors.push(new Meteor(++meteorsID,null,null,s)),playSound(settings.sounds.METEOR.audio)}}}}class HBomb extends Element{constructor(s){let e=player.OBJECT;super(!1,-1,-1,settings.gameAssets.HERO_BOMB.id,s),this.pos={x:e.pos.x+(e.touches.y?settings.blockSize+15:0),y:e.pos.y+e.height},this.gravity=5,this.velocity=0,this.range=settings.gameAssets.HERO_BOMB.range,this.size=25,this.damage=settings.gameAssets.HERO_BOMB.damage}render(){return image(settings.gameAssets.HERO_BOMB.model,this.pos.x,this.pos.y,this.size,this.size),noStroke(),fill("rgba(255, 0, 0, .075)"),ellipse(this.pos.x+this.size/2,this.pos.y+this.size/2,this.range,this.range),this}update(){let s=this.velocity+this.gravity,e=this.pos.y+this.velocity,t=!1;touchableElements.forEach(s=>{s.predictObstacle({x:this.pos.x,y:this.pos.y},this.size,this.size)&&(this.explode(),t=!0)}),t||(this.velocity=s,this.pos.y=e)}explode(){playSound(settings.sounds.EXPLOSION.audio),monsters.forEach(s=>{s.pos.x>this.pos.x-this.range&&s.pos.x<this.pos.x+this.size+this.range&&s.pos.y>this.pos.y-this.range&&s.pos.y<this.pos.y+this.size+this.range&&s.declareDamage&&(s.declareDamage(this.damage,settings.gameAssets.HERO_BOMB.id),s.velocity=-17.5)});let s=hbombs;s.splice(s.findIndex(s=>s.id===this.id),1)}}class Player extends Hero{constructor(){super(0,"hero",null,player.heatlh,player.heatlh,{idle:player.models.idle,run:player.models.run,jump:player.models.jump,fly:player.models.fly},21,35,5,20,7.5,5/(settings.canvas.FPS/30),9,3,player.bulletRange,10,player.id),this.items=[],this.bombAsl=player.bombDelta,this.bombDelta=0,this.touches={x:!1,y:!1}}render(){image(this.model,this.pos.x,this.pos.y);{let s,e;this.set.shield?(s=`Shield (${round(this.set.shield.time/settings.canvas.FPS)}s)`,e="purple"):(s=`Health (${this.health}${this.health!==1/0?"hp":""})`,e="red"),noStroke(),fill(e),rect(0,0,settings.canvas.width/100*(100/(this.maxHealth/this.health)),settings.playerHBHeight),noStroke(),textFont(mainFont),textSize(24),textAlign(CENTER),fill(255),text(s,settings.canvas.width/2,13)}this.set.shield||(this.set.armor&&(noStroke(),fill(15,0,255),rect(0,0,settings.canvas.width/100*(100/(this.maxHealth/this.set.armor.health)),settings.playerHBHeight)),this.set.helmet&&(noStroke(),fill(0,255,0),rect(0,0,settings.canvas.width/100*(100/(this.maxHealth/this.set.helmet.health)),settings.playerHBHeight)));{let s=20,e=5;Object.values(this.set).filter(s=>s).map(s=>s.name).forEach((t,i)=>{let a=settings.gameAssets[t].model;a&&(fill(255),image(a,i*(s+e)+e,settings.playerHBHeight+e,s,s))})}{let s=20,e=10;textFont(mainFont),textSize(25),textAlign(RIGHT),fill(255),this.items.forEach((t,i)=>{let a=settings.gameAssets[t.name];a&&(noStroke(),text(`${a.name} ( ${String.fromCharCode(t.runKey).toLowerCase()} )`,settings.canvas.width-s-2*e,2*settings.playerHBHeight+i*(15+e)),image(a.model,settings.canvas.width-s-e,settings.playerHBHeight+5+i*(15+e),s,s))})}if(this.set.shield){let s=40;image(settings.gameAssets.SHIELD.model,this.pos.x+this.width/2-s/2,this.pos.y+this.height/2-s/2,s,s)}{let s=score.iterations.toString(),e={1:"st",2:"nd",3:"rd"}[s.slice(-1)]||"th";noStroke(),textFont(mainFont),textSize(24),textAlign(CENTER),fill(245),text(`${score.score} points (${s+e} iteration)`,settings.canvas.width/2,settings.playerHBHeight+20)}return session.startTime||(noStroke(),textFont(mainFont),textSize(24),textAlign(CENTER),fill(225),text(`${this.bombDelta?"Reloading...":"Skill"} (${this.bombDelta?floor((this.bombDelta+settings.canvas.FPS)/settings.canvas.FPS):"E"})`,settings.canvas.width/2,settings.playerHBHeight+40)),this}shoot(){!this.isAlive||this.aslDelta>0||(this.aslDelta=this.asl,playSound(settings.sounds.SHOOT.audio),bullets.push(new Bullet(++bulletsID,settings.gameAssets.HERO_BULLET.id,this.damage,settings.gameAssets.HERO_BULLET.model,{x:this.pos.x+(1===this.direction?15:-15),y:this.pos.y+this.height/6},{x:this.direction,y:0},this.bulletSpeed,this.bulletRange)))}pushScore(s){let e=score;e.score+=s,playSound(settings.sounds.SCOREUP.audio),e.score<0&&(e.score=0)}throwBomb(){this.bombDelta||session.startTime||(this.bombDelta=this.bombAsl,hbombs.push(new HBomb(++hbombsID)))}}class Mage extends Hero{constructor(s,e){let t=settings.gameAssets.MAGE;super(s,"hero",{x:e.pos.x+45*e.direction,y:0},t.health,t.health,null,20,20,t.regeneration,t.hitDamage,50,5,10,2,t.bulletRange,t.bulletSpeed,t.id),this.frame=0,this.delay=5,this.stable=!1,this.target=null,this.models=t.models,this.status="app",this.alive=t.alive,this.dead=!1,this.shootAsl=t.shootDelta,this.shootDelta=0,this.teleportAsl=t.teleportDelta,this.teleportDelta=0,this.hitAsl=t.hitDelta,this.hitDelta=0,this.hiting=!0,this.hitFrame=0,this.shootDamage=t.shootDamage,this.teleportDamage=t.teleportDamage}render(){let s=this.models[this.status][this.frame];if(s){if(s.height>this.height&&(this.pos.y-=s.height-this.height),this.height=s.height,this.width=s.width,image(s.model,this.pos.x,this.pos.y,this.width,this.height),this.set.shield||(this.set.armor&&(noStroke(),fill(15,0,255),rect(0,0,settings.canvas.width/100*(100/(this.maxHealth/this.set.armor.health)),settings.playerHBHeight)),this.set.helmet&&(noStroke(),fill(0,255,0),rect(0,0,settings.canvas.width/100*(100/(this.maxHealth/this.set.helmet.health)),settings.playerHBHeight))),"app"!==this.status){let s=10,e=10,t=45;if(noStroke(),textFont(mainFont),textSize(24),textAlign(CENTER),fill(255),text(`${floor(this.alive/settings.canvas.FPS)}s`,this.pos.x+t/2-e,this.pos.y-7.5-s),fill("green"),rect(this.pos.x-t/2+e,this.pos.y-12.5,t/100*(100/(this.maxHealth/this.health)),s),this.hitting){let s=100;image(settings.gameAssets.ELECTRO.model[this.hitFrame],this.pos.x-this.width-5,this.pos.y-this.height+10,s,s)}this.set.shield||(this.set.armor&&(noStroke(),fill(15,0,255),rect(this.pos.x-t/2+e,this.pos.y-12.5,t/100*(100/(this.maxHealth/this.set.armor.health)),s)),this.set.helmet&&(noStroke(),fill(0,255,0),rect(this.pos.x-t/2+e,this.pos.y-12.5,t/100*(100/(this.maxHealth/this.set.helmet.health)),s)))}return this}}animate(){return!this.dead&&--this.alive<=0&&this.die(),--this.shootDelta<0&&(this.shootDelta=0),--this.teleportDelta<0&&(this.teleportDelta=0),--this.hitDelta<0&&(this.hitDelta=0),this.hitting&&++this.hitFrame>settings.gameAssets.ELECTRO.model.length-1&&(this.hitting=!1),--this.delay<0&&(++this.frame>this.models[this.status].length-1&&("app"===this.status?(this.status="summon",this.stable=!0):"dead"===this.status&&this.dead&&mages.splice(mages.findIndex(s=>s.id===this.id),1)),this.frame>this.models[this.status].length-1&&(this.frame=0),this.delay=5),this}think(){if(this.target){if(!1===this.target.isAlive)return this.target=null,this.think();{let s=30,e=40,t=this.target,i=abs(this.pos.x-t.pos.x);this.pos.y>t.pos.y-s&&this.pos.y<t.pos.y+t.size+s&&i>e&&this.shootDelta<=0?this.shoot():this.teleportDelta<=0&&i>e?this.teleport(this.target):this.hitDelta<=0&&i<=e&&this.hit(this.target)}}else{let s=monsters,e=null;if(!s.length)return this.pause();if(1===s.length)e=s[0];else{let t=(e=!1)=>s.find(t=>t.health===max(s.filter(s=>"GROUND"===s.type&&s.isTarget===e).map(s=>s.health)));(e=t(!1))||(e=t(!0))}this.status="summon",this.target=e,this.target.isTarget=!0}return this}teleport(s){this.teleportDelta=this.teleportAsl,this.target.pos=Object.assign({},this.pos),playSound(settings.sounds.TELEPORT.audio),this.hit()}shoot(){playSound(settings.sounds.SHOOT.audio),this.shootDelta=this.shootAsl,bullets.push(new Bullet(++bulletsID,settings.gameAssets.MAGE_BULLET.id,this.shootDamage,settings.gameAssets.MAGE_BULLET.model,{x:this.pos.x,y:this.pos.y},{x:this.target.pos.x>this.pos.x?1:-1,y:0},this.bulletSpeed,this.bulletRange))}hit(s){this.hitDelta=this.hitAsl,this.hitting=!0,this.hitFrame=0,playSound(settings.sounds.MAGE_HIT.audio);let e=settings.gameAssets.MAGE;monsters.forEach(s=>{s.pos.x>=this.pos.x-e.hitRange&&s.pos.x<=this.pos.x+this.width+e.hitRange&&s.pos.y>=this.pos.y-e.hitRange&&s.pos.y<=this.pos.y+this.height+e.hitRange&&"GROUND"===s.type&&(s.velocity=-15,s.declareDamage(e.hitDamage))})}pause(){this.status="dead"}die(){if(this.target){let s=monsters.find(s=>s.id===this.target.id);s&&(s.isTarget=!1)}this.dead=!0,this.delay=5,this.status="dead",this.frame=0}}class MBomb extends Element{constructor(s,e,t,i,a=null,n=!0,o="red"){super(!1,0,0,settings.gameAssets.GORILLA_BOMB.id,0),this.model=settings.gameAssets.GORILLA_BOMB.model,this.size=20,this.color=o,this.id=s,this.frame=0,this.time=100,this.ex=this.exp=!1,this.range=50,this.power=10,this.damage=i,this.gravity=+!n,this.velocity=0,this.target=a||null;{let s=player.OBJECT.pos;this.pos=e||{x:random(s.x-30,s.x+30),y:random(s.y-30,s.y+30)}}}render(){if(fill({red:"rgba(255, 0, 0, .15)",blue:"rgba(0, 0, 255, .15)"}[this.color]),ellipse(this.pos.x+this.size/2,this.pos.y+this.size/2,this.range/100*100/(this.frame/settings.gameAssets.SMOKE.model.length),this.range/100*100/(this.frame/settings.gameAssets.SMOKE.model.length)),this.ex&&this.frame<=settings.gameAssets.SMOKE.model.length){let s=settings.gameAssets.SMOKE.model,e=s[s.length-(s.length-this.frame)];e&&image(e,this.ex.x-e.width/2,this.ex.y)}else image(this.model,this.pos.x,this.pos.y,this.size,this.size);return this}update(){if(this.gravity){let s=this.pos.y+(this.velocity+this.gravity),e=!1;touchableElements.forEach(t=>{let i=t.predictObstacle({x:this.pos.x,y:s},this.size,this.size);!e&&i&&(e=!0)}),e||(this.velocity+=this.gravity,this.pos.y+=this.velocity)}this.time<150&&this.time>50&&!this.ex?this.frame+=5:this.time<50&&!this.ex?this.frame+=10:this.frame++,this.frame>30&&(this.frame=0),this.time--,this.time<=0&&!this.ex&&!this.exp?(this.explode(),this.exp=!0):(this.ex&&this.frame>settings.gameAssets.SMOKE.model.length||!this.ex&&this.time<=0)&&mbombs.splice(mbombs.findIndex(s=>s.id===this.id),1)}explode(){if(!settings.inGame)return;let s=player.OBJECT,e=(s,e)=>e>=s-this.range&&e<=s+this.size+this.range;if(e(s.pos.x,this.pos.x)&&e(s.pos.y,this.pos.y)){if(this.frame=0,this.ex=Object.assign({},s.pos),this.target)s.pos={x:this.target.x,y:this.target.y};else{let e=()=>{let s=s=>floor(random(s)),t=s(map.length),i=s(map[0].length),a=map[t][i].object,n=!1;return a&&a.type!==settings.gameAssets.LAVA.id?(n=!1,items.map(s=>{n||s.pos&&s.type!==this.type&&s.pos.x===a.pos.x&&s.pos.y===a.pos.y-a.size&&(n=!0)}),n?e():(n=!1,map.forEach(s=>s.forEach(({object:s})=>{n||s&&s.pos.x===a.pos.x&&s.pos.y===a.pos.y-a.size&&(n=!0)})),n?e():a)):e()},t=e();s.pos={x:t.pos.x,y:t.pos.y-s.height-1}}s.velocity-=this.power,s.declareDamage(this.damage)}}}class Monster extends Creature{constructor(s,e,t,i=1,a,n=10,o,l,h,g,d,r,m,p,u,c){let E=session.isRage?2:1;"object"!=typeof m?m*=E:Object.keys(m).forEach(s=>{m[s]=m[s]*E}),super(s,"monster",a,e*E,e*E,t,o,o,i*E,n*E,m,random(h*E,g*E),p,l,d,r*E,c),this.type=u,this.size=o,this.isTarget=!1}render(){return this.isTarget&&(fill("blue"),ellipse(this.pos.x+this.size/2-2.5,this.pos.y-12.5-30,10,10)),fill(255,0,0),rect(this.pos.x-this.size/3.5,this.pos.y-12.5,1.5*this.size/100*(100/(this.maxHealth/this.health)),10),image(this.model,this.pos.x,this.pos.y,this.size,this.size),noStroke(),textFont(mainFont),textSize(25),textAlign(CENTER),fill(255),text(`${this.health}hp`,this.pos.x+this.size/2,this.pos.y-10-2.5-5),this}}window.Slime=class extends Monster{constructor(s,e){let t=settings.gameAssets.SLIME;super(s,t.health,t.model,t.regeneration,{x:e?settings.canvas.width:-30,y:0},t.damage,30,t.maxJumps,t.minSpeed,t.maxSpeed,0,0,t.attackDelta,t.jumpHeight,t.subType,t.id)}think(){if(!settings.inGame)return;let s=mages[0]||player.OBJECT,e=(this.pos,s.pos.x,this.size,this.pos.x>s.pos.x-20&&this.pos.x<s.pos.x+s.width+20&&this.pos.y>s.pos.y-20&&this.pos.y<s.pos.y+s.height+20);s.pos.x===this.pos.x||e||(this.movement={true:1,false:-1}[s.pos.x>this.pos.x]),e&&this.aslDelta<=0&&this.attack()}attack(){playSound(settings.sounds.HIT.audio),this.jump(),this.aslDelta=this.asl,(mages[0]||player.OBJECT).declareDamage(this.damage)}detectObstacle(s,e){let t=settings.gameAssets;(s&&s.type===t.BLOCK.id||e&&e.type===t.LAVA.id)&&this.jump()}},window.Lizard=class extends Monster{constructor(s,e){let t=settings.gameAssets.LIZARD;super(s,t.health,t.model,t.regeneration,{x:e?settings.canvas.width:-30,y:0},t.damage,30,t.mapJumps,t.minSpeed,t.maxSpeed,t.bulletRange,t.bulletSpeed,t.attackDelta,t.jumpHeight,t.subType,t.id)}think(){if(!settings.inGame)return;let s=mages[0]||player.OBJECT,e=this,t=abs(s.pos.x-e.pos.x),i=this.bulletRange,a=abs(s.height-e.size),n="pos",o="height",l=s[n].y-a<e[n].y&&s[n].y+s[o]+a>e[n].y+e[o];this.movement=t>.9*i||!l?{true:1,false:-1}[s.pos.x>e.pos.x]:t<.65*i?{true:1,false:-1}[s.pos.x<e.pos.x]:0,t<i&&l&&this.aslDelta<=0&&this.attack(s)}attack(s){playSound(settings.sounds.SHOOT.audio),this.aslDelta=this.asl,bullets.push(new Bullet(++bulletsID,settings.gameAssets.LIZARD_BULLET.id,this.damage,settings.gameAssets.LIZARD_BULLET.model,{x:this.pos.x,y:this.pos.y+this.height/6},{x:s.pos.x>this.pos.x?1:-1,y:0},this.bulletSpeed,this.bulletRange))}detectObstacle(s,e){if(s){let e=s.bottomIndex,t=s.leftIndex,i=map[e];[void 0,0].includes(i[t])||this.jump(),[void 0,0].includes(i[t+this.movement])||this.jump(2)}if(e){let s=e.bottomIndex,t=e.leftIndex,i=map[s],a=i[t],n=i[t+this.movement];[a&&a.magerial,n&&n.magerial].includes(settings.gameAssets.LAVA.id)&&this.jump()}}},window.Gorilla=class extends Monster{constructor(s,e){let t=settings.gameAssets.GORILLA;super(s,t.health,t.model,t.regeneration,{x:e?settings.canvas.width:-45,y:0},t.damage,45,t.mapJumps,t.minSpeed,t.maxSpeed,0,0,{hit:t.attackDelta,bomb:t.bombDelta},t.jumpHeight,t.subType,t.id)}think(){if(!settings.inGame)return;let s=mages[0]||player.OBJECT,e=this.pos,t=abs(s.pos.x-e.x),i=settings.gameAssets.GORILLA.bombRange,a=e.y>s.pos.y-15&&e.y<s.pos.y+s.height+15;s.pos.x!==e.x&&(this.movement={true:1,false:-1}[s.pos.x>e.x]),t<=40&&a&&this.aslDelta.hit<=0?this.hit():t<i&&this.aslDelta.bomb<=0&&this.spawnBomb(s)}spawnBomb(s,e){this.aslDelta.bomb=this.asl.bomb,mbombs.push(new MBomb(++mbombsID,null,settings.gameAssets.GORILLA.bombTime,settings.gameAssets.GORILLA.bombDamage,this.pos,!0,"red"))}hit(){let s=mages[0]||player.OBJECT;this.aslDelta.hit=this.asl.hit,playSound(settings.sounds.HIT.audio),this.jump(),s.declareDamage(this.damage),s.velocity=-15,this.jumps=0}detectObstacle(s){s&&this.jump()}},window.Bird=class extends Element{constructor(s,e){let t=settings.gameAssets.BIRD,i={true:-1,false:1}[e];super(!1,-1,-1,t.id,s,t.subType),this.id=s,this.size=50,this.pos={x:-1===i?settings.canvas.width:0-this.size,y:random(settings.playerHBHeight,settings.playerHBHeight+this.size)},this.dir={x:i,y:0},this.speed={x:random(t.minSpeed,t.maxSpeed),y:.25},this.model=t.model,this.health=t.health,this.bombAsl=t.bombDelta,this.bombDelta=0,this.bombTime=t.bombTime,this.bombDamage=t.bombDamage,this.throwRange=t.throwRange}render(){return image(settings.gameAssets.BIRD.model,this.pos.x,this.pos.y,this.size,this.size),this}update(){return this.pos.x+=this.dir.x*this.speed.x,this.pos.y+=random(-1,1)*this.dir.y,touchableElements.forEach(s=>{if(s.type===settings.gameAssets.HERO_BULLET.id){let e=s.predictObstacle(this.pos,this.size,this.size);e&&(this.kill(!1),e.destroy())}}),--this.bombDelta<0&&(this.bombDelta=0),(-1===this.dir.x&&this.pos.x+this.size<0||1===this.dir.x&&this.pos.x>settings.canvas.width)&&this.kill(!0),this}think(){let s=player.OBJECT;return this.pos.y<s.pos.y&&s.pos.x>this.pos.x-this.throwRange&&s.pos.x<this.pos.x+this.size+this.throwRange&&this.bombDelta<=0&&this.throwBomb(),this}throwBomb(){this.bombDelta=this.bombAsl,mbombs.push(new MBomb(++mbombsID,{x:this.pos.x,y:this.pos.y+this.size},this.bombTime,this.bombDamage,null,!1,"blue"))}kill(s=!0){s||player.OBJECT.pushScore(scoreDef.MONSTER_KILL),monsters.splice(monsters.findIndex(s=>s.id===this.id),1)}};class Item extends Element{constructor(s,e,t,i){super(!1,0,0,i,0),this.size=30,this.isVisible=t,this.model=e,this.id=s,this.pos=null}render(){if(this.isVisible)return this.pos||(this.pos=this.genPos()),image(this.model,this.pos.x,this.pos.y,this.size,this.size),this}destroy(){let s=items;s.splice(s.findIndex(s=>s.id===this.id),1)}genPos(){let s=()=>{let e=s=>floor(random(s)),t=e(map.length),i=e(map[0].length),a=map[t][i].object,n=!1;return a&&a.type!==settings.gameAssets.LAVA.id?(n=!1,items.map(s=>{n||s.pos&&s.type!==this.type&&s.pos.x===a.pos.x&&s.pos.y===a.pos.y-a.size&&(n=!0)}),n?s():(n=!1,map.forEach(s=>s.forEach(({object:s})=>{n||s&&s.pos.x===a.pos.x&&s.pos.y===a.pos.y-a.size&&(n=!0)})),n?s():a)):s()},e=s();return{x:e.pos.x,y:e.pos.y-e.size}}}function preload(){mainFont=loadFont("./assets/mainFont.ttf"),settings.gameAssets.BACKGROUND_MENU.model=loadImage("./assets/backgrounds/menu.png"),settings.gameAssets.BACKGROUND_1.model=loadImage("./assets/backgrounds/game1.jpg"),settings.gameAssets.BACKGROUND_2.model=loadImage("./assets/backgrounds/game2.jpg"),settings.gameAssets.BACKGROUND_3.model=loadImage("./assets/backgrounds/game3.jpg"),settings.gameAssets.BACKGROUND_4.model=loadImage("./assets/backgrounds/game4.jpg"),settings.gameAssets.BACKGROUND_5.model=loadImage("./assets/backgrounds/game5.jpg"),settings.gameAssets.BLOCK.model=loadImage("./assets/block.png"),settings.gameAssets.GLASS.model=loadImage("./assets/block_glass.png"),settings.gameAssets.HEALTH_BOTTLE.model=loadImage("./assets/items/heal.png"),settings.gameAssets.ARMOR_1.model=loadImage("./assets/items/arm1.png"),settings.gameAssets.ARMOR_2.model=loadImage("./assets/items/arm2.png"),settings.gameAssets.ARMOR_3.model=loadImage("./assets/items/arm3.png"),settings.gameAssets.ARMOR_4.model=loadImage("./assets/items/arm4.png"),settings.gameAssets.HERO_BULLET.model=loadImage("./assets/bullets/fireball.png"),settings.gameAssets.LIZARD_BULLET.model=loadImage("./assets/bullets/monster1.gif"),settings.gameAssets.MONSTER_2_BULLET.model=loadImage("./assets/bullets/monster2.gif"),settings.gameAssets.MAGE_BULLET.model=loadImage("./assets/bullets/mage.png"),settings.gameAssets.BOOTS.model=loadImage("./assets/items/boots.png"),settings.gameAssets.HELMET.model=loadImage("./assets/items/helm.png"),settings.gameAssets.MAGE_SPAWNER.model=loadImage("./assets/items/mageSpawner.png"),settings.gameAssets.SHIELD_ITEM.model=loadImage("./assets/items/shield.png"),settings.gameAssets.GOLD_KEY.model=loadImage("./assets/items/goldkey.png"),settings.gameAssets.SILVER_KEY.model=loadImage("./assets/items/silverkey.png"),settings.gameAssets.BRONZE_KEY.model=loadImage("./assets/items/bronzekey.png"),settings.gameAssets.SHIELD.model=loadImage("./assets/items/shieldEffect.png"),settings.gameAssets.METEOR_SUMMONER.model=loadImage("./assets/items/sMeteor.png"),settings.gameAssets.METEOR.model=loadImage("./assets/items/meteor.png"),settings.gameAssets.GORILLA_BOMB.model=loadImage("./assets/items/bomb.png"),settings.gameAssets.HERO_BOMB.model=loadImage("./assets/items/playerBomb.png"),settings.devTesting||(settings.gameAssets.SLIME.model=loadImage("./assets/monsters/slime.gif"),settings.gameAssets.LIZARD.model=loadImage("./assets/monsters/lizard.gif"),settings.gameAssets.GORILLA.model=loadImage("./assets/monsters/gorilla.png"),settings.gameAssets.BIRD.model=loadImage("./assets/monsters/bird.gif")),player.models.idle=loadImage("./assets/hero/idle.gif"),player.models.run=loadImage("./assets/hero/run.gif"),player.models.jump=loadImage("./assets/hero/jump.png"),player.models.fly=loadImage("./assets/hero/fly.gif"),settings.icons.SOUNDS_ICON.image=loadImage("./assets/icons/sound.png"),settings.icons.MUSIC_ICON.image=loadImage("./assets/icons/music.png"),settings.icons.HOOK_ICON.image=loadImage("./assets/icons/hook.png"),settings.sounds.ARMOR_GET.audio=loadSound("./assets/sounds/armorget.wav"),settings.sounds.DIE.audio=loadSound("./assets/sounds/dead.wav"),settings.sounds.HIT.audio=loadSound("./assets/sounds/hit.wav"),settings.sounds.ITEM_GET.audio=loadSound("./assets/sounds/itemget.wav"),settings.sounds.JUMP.audio=loadSound("./assets/sounds/jump.wav"),settings.sounds.MAGE_HIT.audio=loadSound("./assets/sounds/mage_hit.wav"),settings.sounds.MAGE_SUMMON.audio=loadSound("./assets/sounds/magesummon.wav"),settings.sounds.METEOR.audio=loadSound("./assets/sounds/meteor.wav"),settings.sounds.RAGE.audio=loadSound("./assets/sounds/rage.wav"),settings.sounds.RAVE.audio=loadSound("./assets/sounds/rave.wav"),settings.sounds.SELECT.audio=loadSound("./assets/sounds/select.wav"),settings.sounds.SHOOT.audio=loadSound("./assets/sounds/shoot.wav"),settings.sounds.START_LEVEL.audio=loadSound("./assets/sounds/start_level.wav"),settings.sounds.TELEPORT.audio=loadSound("./assets/sounds/teleport.wav"),settings.sounds.TEXT.audio=loadSound("./assets/sounds/text.wav"),settings.sounds.SELECT.audio=loadSound("./assets/sounds/select.wav"),settings.sounds.SCOREUP.audio=loadSound("./assets/sounds/scoreup.wav"),settings.sounds.EXPLOSION.audio=loadSound("./assets/sounds/explosion.mp3"),settings.devTesting||(settings.music.MEGALOVANIA.audio=loadSound("./assets/music/megalovania.mp3"),settings.music.BONETROUSLE.audio=loadSound("./assets/music/bonetrousle.mp3"),settings.music.ASGORE.audio=loadSound("./assets/music/asgore.mp3")),["./assets/lava/1.png","./assets/lava/2.png","./assets/lava/3.png","./assets/lava/4.png","./assets/lava/5.png","./assets/lava/6.png","./assets/lava/7.png","./assets/lava/8.png","./assets/lava/9.png","./assets/lava/10.png","./assets/lava/11.png","./assets/lava/12.png","./assets/lava/13.png","./assets/lava/14.png","./assets/lava/15.png","./assets/lava/16.png","./assets/lava/17.png","./assets/lava/18.png","./assets/lava/19.png","./assets/lava/20.png","./assets/lava/21.png","./assets/lava/22.png","./assets/lava/23.png","./assets/lava/24.png","./assets/lava/25.png","./assets/lava/26.png","./assets/lava/27.png","./assets/lava/28.png","./assets/lava/29.png","./assets/lava/30.png","./assets/lava/31.png","./assets/lava/32.png","./assets/lava/34.png","./assets/lava/35.png","./assets/lava/36.png","./assets/lava/37.png","./assets/lava/38.png","./assets/lava/39.png","./assets/lava/40.png","./assets/lava/41.png","./assets/lava/42.png","./assets/lava/43.png","./assets/lava/44.png","./assets/lava/45.png"].forEach(s=>{settings.gameAssets.LAVA.model.push(loadImage(s))}),["./assets/tpsmoke/1.gif","./assets/tpsmoke/2.gif","./assets/tpsmoke/3.gif","./assets/tpsmoke/4.gif","./assets/tpsmoke/5.gif","./assets/tpsmoke/6.gif","./assets/tpsmoke/7.gif"].forEach(s=>{settings.gameAssets.SMOKE.model.push(loadImage(s))}),[{model:"./assets/mage/app_1.png",height:20,width:20,arr:"app"},{model:"./assets/mage/app_2.png",height:20,width:20,arr:"app"},{model:"./assets/mage/app_3.png",height:20,width:20,arr:"app"},{model:"./assets/mage/app_4.png",height:20,width:20,arr:"app"},{model:"./assets/mage/attack_1.png",height:20,width:20,arr:"attack"},{model:"./assets/mage/attack_2.png",height:20,width:20,arr:"attack"},{model:"./assets/mage/attack_3.png",height:20,width:20,arr:"attack"},{model:"./assets/mage/attack_4.png",height:20,width:20,arr:"attack"},{model:"./assets/mage/go_1.png",height:20,width:20,arr:"go"},{model:"./assets/mage/go_2.png",height:20,width:20,arr:"go"},{model:"./assets/mage/jump.png",height:20,width:20,arr:"jump"},{model:"./assets/mage/stay.png",height:35,width:20,arr:"stay"},{model:"./assets/mage/summon.gif",height:40,width:35,arr:"summon"},{model:"./assets/mage/dead_1.png",height:20,width:20,arr:"dead"},{model:"./assets/mage/dead_2.png",height:20,width:20,arr:"dead"},{model:"./assets/mage/dead_3.png",height:20,width:20,arr:"dead"},{model:"./assets/mage/dead_4.png",height:20,width:20,arr:"dead"}].forEach(s=>{settings.gameAssets.MAGE.models[s.arr].push({model:loadImage(s.model),height:s.height,width:s.width})}),["./assets/electro/1.png","./assets/electro/2.png","./assets/electro/3.png","./assets/electro/4.png","./assets/electro/5.png","./assets/electro/6.png","./assets/electro/7.png","./assets/electro/8.png","./assets/electro/9.png","./assets/electro/10.png","./assets/electro/11.png","./assets/electro/12.png","./assets/electro/13.png","./assets/electro/14.png","./assets/electro/15.png","./assets/electro/16.png","./assets/electro/17.png","./assets/electro/18.png","./assets/electro/19.png","./assets/electro/20.png","./assets/electro/21.png","./assets/electro/22.png","./assets/electro/23.png","./assets/electro/24.png","./assets/electro/25.png","./assets/electro/26.png","./assets/electro/27.png","./assets/electro/28.png","./assets/electro/29.png","./assets/electro/30.png","./assets/electro/31.png","./assets/electro/32.png","./assets/electro/33.png","./assets/electro/34.png","./assets/electro/35.png","./assets/electro/36.png","./assets/electro/37.png","./assets/electro/38.png","./assets/electro/39.png","./assets/electro/40.png","./assets/electro/41.png","./assets/electro/42.png","./assets/electro/43.png","./assets/electro/44.png","./assets/electro/45.png","./assets/electro/46.png","./assets/electro/47.png","./assets/electro/48.png","./assets/electro/49.png","./assets/electro/50.png","./assets/electro/51.png","./assets/electro/52.png","./assets/electro/53.png","./assets/electro/54.png","./assets/electro/55.png","./assets/electro/56.png","./assets/electro/57.png","./assets/electro/58.png","./assets/electro/59.png","./assets/electro/60.png","./assets/electro/61.png","./assets/electro/62.png","./assets/electro/63.png"].forEach(s=>{settings.gameAssets.ELECTRO.model.push(loadImage(s))})}function setup(){settings.canvas.target=createCanvas(settings.canvas.width,settings.canvas.height).elt,frameRate(settings.canvas.FPS);{let s=localStorage.getItem("GLOBAL_SETTINGS");(s=s&&JSON.parse(s))?settings={...settings,...s}:s||updateLocalStorage()}settings.gmTesting&&start(!1)}function draw(){if(settings.inMenu){image(settings.gameAssets.BACKGROUND_MENU.model,0,0,settings.canvas.width,settings.canvas.height);let s=45,e=215,t=2.5,i=4,a=12.5,n=!1,o=45,l=30;[{placeID:0,title:"DEATHMATCH",color:"#92CD41",type:"MENU",onClick:()=>{start(!0),playSound(settings.sounds.SELECT.audio)}},{placeID:1,title:"Adventure",color:"#E76E55",type:"MENU",onClick:()=>{alert("CHECK THE CONSOLE"),console.warn("Adventure mode is not supported yet. You can contact me if you want to help."),console.error("Stop(0)")}},{placeID:0,icon:settings.icons.SOUNDS_ICON.image,active:"#92CD41",disabled:"#E76E55",type:"CONTROLS",isActive:settings.soundsOn,onClick:()=>{settings.soundsOn=!settings.soundsOn,updateLocalStorage()}},{placeID:1,icon:settings.icons.MUSIC_ICON.image,active:"#92CD41",disabled:"#E76E55",type:"CONTROLS",isActive:settings.musicOn,onClick:()=>{settings.musicOn=!settings.musicOn,updateLocalStorage()}},{placeID:0,icon:settings.icons.HOOK_ICON.image,active:"#92CD41",disabled:"#E76E55",type:"ADDONS",isActive:settings.playerCanHook,onClick:()=>{settings.playerCanHook=!settings.playerCanHook,updateLocalStorage()}}].forEach(h=>{let g="MENU"===h.type?s:o,d="MENU"===h.type?e:o;if("MENU"===h.type)var r=settings.canvas.width/2-d/2,m=settings.canvas.height/2+(g+a)*h.placeID;else if("CONTROLS"===h.type)r=(a+o)*h.placeID+a,m=a;else if("ADDONS"===h.type)r=settings.canvas.width-(a+o)*(h.placeID+1),m=a;"MENU"===h.type?fill(h.color):fill(h.isActive?h.active:h.disabled),strokeWeight(i),stroke("rgba(0, 0, 0, .45)"),rect(r,m,d,g),noStroke(),strokeWeight(0),fill("rgba(240, 240, 240, .4)"),"MENU"!==h.type&&!0!==h.isActive||(rect(r+d-t-i/2,m+i/2,t,g-i),rect(r+t/2,m+g-i,d-1.5*t,t)),"MENU"===h.type?(noStroke(),textFont(mainFont),textSize(40),textAlign(CENTER),fill(255),text(h.title.toUpperCase(),r+d/2+2,m+g/2+9)):image(h.icon,r+o/2-l/2,m+o/2-l/2,l,l);let p=s=>s.x>r-i&&s.x<r+d+i&&s.y>m-i&&s.y<m+g+i,u=settings.menuMouseClick;p(settings.menuMouseMove)&&!n?(settings.canvas.target.style.cursor="pointer",n=!0):n||(settings.canvas.target.style.cursor="default"),u&&u.x&&u.y&&p(u)&&(u.x=u.y=null,h.onClick())})}else{if(image(settings.gameplayBackground,0,0,settings.canvas.width,settings.canvas.height),session.startTime){session.startTime--;let s=s=>round(session.startTime/(settings.canvas.FPS-s));s(0)!==s(1)&&playSound(settings.sounds.TEXT.audio),noStroke(),textFont(mainFont),textSize(64),textAlign(CENTER),fill(245),text(`STARTING IN: ${s(0)}`,settings.canvas.width/2,settings.playerHBHeight+75)}if(settings.inGame&&!settings.devTesting&&session.ravesTi&&--session.raveDelta<=0&&(defaultSession.raveDelta=random(settings.rave.minDelta,settings.rave.maxDelta),defaultSession.raveEnd=random(settings.rave.minEnd,settings.rave.maxEnd),session.raveDelta=defaultSession.raveDelta,session.raveEnd=defaultSession.raveEnd,--session.ravesTi<=0&&(session.ravesTi=null),session.isRave||(playSound(settings.sounds.RAVE.audio),session.isRave=!0)),settings.inGame&&!settings.devTesting&&!session.startTime&&session.isRave&&--session.raveEnd){let s="";s=0===(s=>floor(session.raveEnd%s))(2)?"red":"blue",noStroke(),textFont(mainFont),textSize(64),textAlign(CENTER),fill(s),text("RAVE",settings.canvas.width/2,settings.playerHBHeight+75),session.raveEnd<=0&&(session.isRave=!1)}if(settings.inGame&&!settings.devTesting&&session.ragesTi&&--session.rageDelta<=0&&(defaultSession.rageDelta=random(settings.rage.minDelta,settings.rage.maxDelta),defaultSession.rageEnd=random(settings.rage.minEnd,settings.rage.maxEnd),session.rageDelta=defaultSession.rageDelta,session.rageEnd=defaultSession.rageEnd,session.rageDelta=defaultSession.rageDelta,session.rageEnd=defaultSession.rageEnd,--session.ragesTi<=0&&(session.ragesTi=null),session.isRage||(playSound(settings.sounds.RAGE.audio),session.isRage=!0)),settings.inGame&&!settings.devTesting&&!session.startTime&&session.isRage&&--session.rageEnd){let s="";s=0===(s=>floor(session.rageEnd%s))(2)?"red":"blue",noStroke(),textFont(mainFont),textSize(64),textAlign(CENTER),fill(s),text("RAGE",settings.canvas.width/2,settings.playerHBHeight+75),session.rageEnd<=0&&(session.isRage=!1)}if(settings.inGame&&!settings.devTesting&&!session.startTime&&settings.inGame&&--session.monsterDelta<=0){session.monsterDelta=session.isRave?random(settings.rave.ravesTime-settings.rave.ravesTimeRange,settings.rave.ravesTime+settings.rave.ravesTimeRange):random(session.monsterMinTime,session.monsterMaxTime);let s=Object.values(settings.gameAssets).filter(s=>"MONSTER"===s.type).map(s=>s.class);monsters.push(new(window[s[floor(random(s.length))]])(++monstersID,[!0,!1][round(random(0,1))]))}if(settings.inGame&&++itemsRefresh.delta>=itemsRefresh.wait&&settings.inGame){if(itemsRefresh.started){let s=settings.gameAssets,e=Object.keys(s).filter(e=>"ITEM"===s[e].type),t=e[floor(random(e.length))],{model:i,id:a}=s[t];items.push(new Item(++itemsID,i,!0,a))}else itemsRefresh.started=!0;itemsRefresh.wait=round(random(300,900)),itemsRefresh.delta=1}touchableElements=[],map.forEach((s,e,t)=>{s.forEach((s,t,i)=>{if(s)if(Number.isInteger(s)){{let e=settings.gameAssets;var a={[e.BLOCK.markupID]:e.BLOCK.id,[e.LAVA.markupID]:e.LAVA.id,[e.GLASS.markupID]:e.BLOCK.id}[s]}switch(s){case settings.gameAssets.BLOCK.markupID:var n=new Block(t,e,a,settings.gameAssets.BLOCK.model);break;case settings.gameAssets.LAVA.markupID:n=new Lava(t,e,a);break;case settings.gameAssets.GLASS.markupID:n=new Block(t,e,a,settings.gameAssets.GLASS.model);break;default:return}i[t]={object:n,material:a}}else touchableElements.push(s.object),s.object.render(),s.object.update&&s.object.update()})}),items.forEach(s=>{touchableElements.push(s),s.render()}),mbombs.forEach(s=>{s.render().update()}),hbombs.forEach(s=>{s.render().update()}),bullets.forEach(s=>{touchableElements.push(s),s.render().update()}),meteors.forEach(s=>{touchableElements.push(s),s.render().update()}),monsters.forEach(s=>{s.render().update().think()}),mages.forEach(s=>{s.render().update().animate(),s.stable&&s.think()}),player.OBJECT.render().update().regenerate(),settings.inGame||(noStroke(),textFont(mainFont),textSize(64),textAlign(CENTER),fill(255),text("YOU DIED! (click)",settings.canvas.width/2,settings.canvas.height/2+20))}}function mouseMoved(){settings.inMenu&&(settings.menuMouseMove={x:mouseX,y:mouseY})}function mousePressed(){settings.inMenu?settings.menuMouseClick={x:mouseX,y:mouseY}:settings.inMenu||settings.inGame||start(!1)}function mouseReleased(){settings.menuMouseClick={x:null,y:null}}function keyPressed(){!settings.inMenu&&settings.inGame&&player.OBJECT&&([65,68].includes(keyCode)?player.OBJECT.controlPos(65===keyCode?-1:1):32===keyCode?player.OBJECT.jump():13===keyCode?player.OBJECT.shoot():69===keyCode?player.OBJECT.throwBomb():player.OBJECT.useItem(keyCode))}function keyReleased(){!settings.inMenu&&settings.inGame&&player.OBJECT&&player.OBJECT&&(-1===player.OBJECT.direction&&65===keyCode||1===player.OBJECT.direction&&68===keyCode)&&player.OBJECT.controlPos(0)}